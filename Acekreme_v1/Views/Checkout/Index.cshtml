@{
    ViewData["Title"] = "Checkout";
    var clientId = (string)ViewBag.PayPalClientId;
    var currency = (string)ViewBag.Currency;
}
<h1>Checkout</h1>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="mb-3">
            <label for="amount" class="form-label">Total (CAD)</label>
            <input type="number" step="0.01" id="amount" class="form-control" placeholder="Enter amount" required />
        </div>
        <div id="paypal-button-container" class="mt-3"></div>
    </div>
</div>

@section Scripts {
    <script src="https://www.paypal.com/sdk/js?client-id=@clientId&currency=@currency"></script>
    <script>
        paypal.Buttons({
          createOrder: (data, actions) => {
            const total = document.getElementById("amount").value || "0.00";
            return actions.order.create({
              purchase_units: [{ amount: { value: total } }]
            });
          },
          onApprove: (data, actions) => {
            return actions.order.capture().then(details => {
              window.location.href = '/Checkout/Success';
            });
          },
          onError: err => {
            console.error(err);
            alert("Payment error. Please try again.");
          }
        }).render('#paypal-button-container');
    </script>
}
